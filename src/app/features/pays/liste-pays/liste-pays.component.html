<div class="pays-container">
  <h1>Liste des pays</h1>

  <!-- Message de chargement -->
  <div *ngIf="loading" class="loading">
    <p>Chargement des pays...</p>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="error && !loading" class="error">
    <p>{{ error }}</p>
    <p *ngIf="error.includes('connexion')">
      Une nouvelle tentative sera effectuée automatiquement...
    </p>
  </div>

  <div *ngIf="!loading && !error">
    <!-- Filtres -->
    <div class="filters">
      <div class="field">
        <label>Recherche</label>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onFiltersChange()"
          placeholder="Rechercher un pays..."
        />
      </div>

      <div class="field">
        <label>Continent / Région</label>
        <select
          [(ngModel)]="selectedRegion"
          (ngModelChange)="onFiltersChange()"
        >
          <option value="">Tous</option>
          <option *ngFor="let region of regions" [value]="region">{{ region }}</option>
        </select>
      </div>

      <div class="field field-inline">
        <div class="count">{{ filteredPays.length }} pays</div>
      </div>
    </div>

    <!-- Aucun résultat -->
    <div *ngIf="filteredPays.length === 0" class="error">
      <p>Aucun pays trouvé. Essayez de modifier vos critères de recherche.</p>
    </div>

    <!-- Liste des pays -->
    <div *ngIf="filteredPays.length > 0" class="pays-grid">
      <a
        *ngFor="let pays of pagedPays; trackBy: trackPays"
        [routerLink]="['/pays', pays.cca3]"
        (mouseenter)="prefetchDetail(pays.cca3)"
        class="pays-card"
      >
        <div class="pays-flag">
          <img
            [src]="pays.flags.png"
            [alt]="'Drapeau de ' + pays.name.common"
            loading="lazy"
          />
        </div>

        <div class="pays-info">
          <h2>{{ pays.name.common }}</h2>
          <p>Région : {{ pays.region || 'Non spécifiée' }}</p>
        </div>
      </a>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button
        (click)="prevPage()"
        [disabled]="currentPage === 1"
      >
        Précédent
      </button>

      <span class="page-info">Page {{ currentPage }} sur {{ totalPages }}</span>

      <button
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
      >
        Suivant
      </button>
    </div>
  </div>
</div>