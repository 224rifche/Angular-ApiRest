<div class="pays-container">
  <h1>Liste des pays</h1>

  @if (!loading && !error) {
    <div class="filters">
      <div class="field">
        <label for="search">Recherche</label>
        <input
          id="search"
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onFiltersChange()"
          placeholder="Rechercher un pays...">
      </div>

      <div class="field">
        <label for="region">Continent / Région</label>
        <select id="region" [(ngModel)]="selectedRegion" (change)="onFiltersChange()">
          <option value="">Tous</option>
          @for (r of regions; track r) {
            <option [value]="r">{{ r }}</option>
          }
        </select>
      </div>

      <div class="field field-inline">
        <div class="count">
          {{ filteredPays.length }} pays
        </div>
      </div>
    </div>
  }
  
  @if (loading) {
    <div class="loading">
      <p>Chargement des pays...</p>
    </div>
  }

  @if (error) {
    <div class="error">
      <p>{{ error }}</p>
    </div>
  }

  @if (!loading && !error) {
    <div class="pays-grid">
      @for (pays of pagedPays; track trackPays($index, pays)) {
        <a class="pays-card" [routerLink]="['/pays', pays.cca3]" (mouseenter)="prefetchDetail(pays.cca3)">
          <div class="pays-flag">
            <img [src]="pays.flags.png" [alt]="'Drapeau de ' + pays.name.common" loading="lazy">
          </div>
          <div class="pays-info">
            <h2>{{ pays.name.common }}</h2>
            <p><strong>Région :</strong> {{ pays.region || '—' }}</p>
          </div>
        </a>
      }
    </div>

    @if (totalPages > 1) {
      <div class="pagination">
        <button type="button" (click)="prevPage()" [disabled]="currentPage === 1">Précédent</button>
        <div class="page-info">Page {{ currentPage }} / {{ totalPages }}</div>
        <button type="button" (click)="nextPage()" [disabled]="currentPage === totalPages">Suivant</button>
      </div>
    }
  }
</div>